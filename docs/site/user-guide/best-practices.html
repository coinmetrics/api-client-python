
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://coinmetrics.github.io/api-client-python/site/user-guide/best-practices.html">
      
      
        <link rel="prev" href="introduction.html">
      
      
        <link rel="next" href="examples.html">
      
      
      <link rel="icon" href="../assets/images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Best Practices - Coin Metrics Python API Client</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Lato";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#best-practices" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Coin Metrics Python API Client" class="md-header__button md-logo" aria-label="Coin Metrics Python API Client" data-md-component="logo">
      
  <img src="../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Coin Metrics Python API Client
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Best Practices
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/coinmetrics/api-client-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../index.html" class="md-tabs__link">
          
  
  
    
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../reference/api_client.html" class="md-tabs__link">
          
  
  
    
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../releases/CHANGELOG.html" class="md-tabs__link">
        
  
  
    
  
  Releases

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../tools/FlatFilesExport.html" class="md-tabs__link">
          
  
  
    
  
  Tools

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Coin Metrics Python API Client" class="md-nav__button md-logo" aria-label="Coin Metrics Python API Client" data-md-component="logo">
      
  <img src="../assets/images/logo.png" alt="logo">

    </a>
    Coin Metrics Python API Client
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/coinmetrics/api-client-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" checked>
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Best Practices
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            Best Practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Best Practices
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="best-practices.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Best Practices
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#page-size" class="md-nav__link">
    <span class="md-ellipsis">
      Page Size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wildcards" class="md-nav__link">
    <span class="md-ellipsis">
      Wildcards
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-catalog-to-determine-assets-or-markets" class="md-nav__link">
    <span class="md-ellipsis">
      Using Catalog to Determine Assets or Markets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parallel-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Parallel Execution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parallel Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#splitting-parameter-queries" class="md-nav__link">
    <span class="md-ellipsis">
      Splitting Parameter Queries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-parallelization-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      General Parallelization Guidelines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lazy-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Lazy Execution
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="examples.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" >
        
          
          <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            Troubleshooting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="troubleshooting.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/api_client.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Api client
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../releases/CHANGELOG.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Releases
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/FlatFilesExport.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flat Files Exporter (Deprecated)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h1>
<p>This section will teach you the best practices for using the Python API Client. See also <a href="https://docs.coinmetrics.io/tutorials-and-examples/user-guides/how-to-use-the-coin-metrics-api-efficiently-http#python-api-client">this guide</a> for more general guidelines on how to use the Coin Metrics API.</p>
<h2 id="page-size">Page Size<a class="headerlink" href="#page-size" title="Permanent link">&para;</a></h2>
<p>Queries can be made much faster by increasing the <code>page_size</code> parameter. The higher the page_size, the faster the query, with a maximum of <code>page_size=10000</code></p>
<h2 id="wildcards">Wildcards<a class="headerlink" href="#wildcards" title="Permanent link">&para;</a></h2>
<p>Wildcards (<code>*</code>) allow you to query several entities, such as assets, exchanges, and markets, as one parameter. For example:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Get prices for all assets</span>
<span class="n">asset_metrics</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_asset_metrics</span><span class="p">(</span><span class="n">assets</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="s1">&#39;PriceUSD&#39;</span><span class="p">,</span> <span class="n">limit_per_asset</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Get btc-usd candles for all exchanges</span>
<span class="n">market_candles_btc_usd</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_market_candles</span><span class="p">(</span><span class="n">markets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*-btc-usd-spot&#39;</span><span class="p">],</span> <span class="n">limit_per_market</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Get all spot exchanges and pairs</span>
<span class="n">exchanges_reference</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">reference_data_exchanges</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

<span class="n">market_candles_spot</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_market_candles</span><span class="p">(</span><span class="n">markets</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">exchange</span><span class="si">}</span><span class="s1">-*-spot&#39;</span> <span class="k">for</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">exchanges_reference</span><span class="p">],</span> <span class="n">limit_per_market</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<h2 id="using-catalog-to-determine-assets-or-markets">Using Catalog to Determine Assets or Markets<a class="headerlink" href="#using-catalog-to-determine-assets-or-markets" title="Permanent link">&para;</a></h2>
<p>Most common use cases can be achieved following the pattern shown below.</p>
<p><img alt="API_Flow_Illustration" src="../assets/images/api_flow.png" /></p>
<p>For example, let's follow the flow indicated in light blue.</p>
<p>Step 1: Obtain all possible markets with a certain criterion, e.g. type='spot' or base='btc'. </p>
<div class="highlight"><pre><span></span><code><span class="c1"># Step 1</span>
<span class="n">spot_markets</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">reference_data_markets</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;spot&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
</code></pre></div>
<p>Step 2: Query the catalog for the data set we desire, e.g. market candles, to deliver more metadata
for the markets we identified in step 1. This step will allow us to remove, using appropriate python code, to remove obsolete markets. </p>
<p><a href="https://youtu.be/YSC_pwd1B5k?si=DAEQaSthsE4uumkK&amp;t=71">Demo Video</a></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Step 2</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">catalog_market_candles_v2</span><span class="p">(</span>
    <span class="n">markets</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">spot_markets</span><span class="o">.</span><span class="n">market</span><span class="p">),</span>
<span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;1m&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">max_time</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>The code above, for example, whittles down all possible market candles to only the ones with 1m frequency and 
data available until at least 2 days ago. This means it eliminates obsolete markets. </p>
<p>Step 3: Obtain the actual timeseries data, and we can be certain that all markets exist and are
relevant to our use case.</p>
<p>A similar logic can be applied when downloading asset metrics. Rather than going straight to the <code>get_asset_metrics</code> 
endpoint, we recommend using the reference data and catalog endpoints to craft the list of assets and metrics. 
Of course, a user may want to start with the catalog of available metrics and only later join the asset reference 
data -- the API is flexible and stateless. </p>
<h2 id="parallel-execution">Parallel Execution<a class="headerlink" href="#parallel-execution" title="Permanent link">&para;</a></h2>
<p>There are times when it may be useful to pull in large amounts of data at once. The most effective way to do this 
when calling the CoinMetrics API is to split your request into many different queries. This functionality is now 
built into the API Client directly to allow for faster data export:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">coinmetrics.api_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">CoinMetricsClient</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">CoinMetricsClient</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CM_API_KEY&#39;</span><span class="p">])</span>
    <span class="n">coinbase_eth_markets</span> <span class="o">=</span> <span class="p">[</span><span class="n">market</span><span class="p">[</span><span class="s1">&#39;market&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">market</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">catalog_market_candles_v2</span><span class="p">(</span><span class="n">exchange</span><span class="o">=</span><span class="s2">&quot;coinbase&quot;</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="s2">&quot;eth&quot;</span><span class="p">)]</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="s2">&quot;2024-03-01&quot;</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="s2">&quot;2024-05-01&quot;</span>
    <span class="n">client</span><span class="o">.</span><span class="n">get_market_candles</span><span class="p">(</span>
      <span class="n">markets</span><span class="o">=</span><span class="n">coinbase_eth_markets</span><span class="p">,</span>
      <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
      <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span>
      <span class="n">page_size</span><span class="o">=</span><span class="mi">1000</span>
    <span class="p">)</span><span class="o">.</span><span class="n">parallel</span><span class="p">()</span><span class="o">.</span><span class="n">export_to_json_files</span><span class="p">()</span>
</code></pre></div>
<p>This feature splits the request into multiple threads and either store them in separate files (in the case of <code>.parallel().export_to_csv_files()</code> and <code>.parallel().export_to_json_files</code>)
or combine them all into one file or data structure (in the case of <code>.parallel().to_list()</code>, <code>.parallel().to_dataframe()</code>,
<code>.parallel().export_to_json()</code>). It's important to know that in order to send more requests per second to the CoinMetrics
this uses the <a href="https://docs.python.org/3/library/concurrent.futures.html">parallel tasks features in Python's concurrent.futures</a>
package. This means when using this feature, the API Client will use significantly more resources and may approach
the <a href="https://docs.python.org/3/library/concurrent.futures.html">Coin Metrics rate limits</a>. </p>
<p>In terms of resource usage and speed, these usages are in order from most performant to least:</p>
<ul>
<li><code>.export_to_json_files()</code></li>
<li><code>.export_to_csv_files()</code></li>
<li><code>.to_list()</code></li>
<li><code>.export_to_json()</code></li>
<li><code>.to_dataframe()</code></li>
</ul>
<h3 id="splitting-parameter-queries">Splitting Parameter Queries<a class="headerlink" href="#splitting-parameter-queries" title="Permanent link">&para;</a></h3>
<p>There is a feature <code>time_increment</code> that can be used to split a single query into many based on time range, and then 
combine them later. Consider this example where we speed up getting a 2 months worth of BTC ReferenceRateUSD data into
many parallel threads to create a dataframe faster: 
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">coinmetrics.api_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">CoinMetricsClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="n">relativedelta</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">CoinMetricsClient</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;CM_API_KEY&quot;</span><span class="p">))</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">assets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;btc&quot;</span><span class="p">,</span> <span class="s2">&quot;eth&quot;</span><span class="p">,</span> <span class="s2">&quot;sol&quot;</span><span class="p">]</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">client</span><span class="o">.</span><span class="n">get_asset_metrics</span><span class="p">(</span>
        <span class="n">assets</span><span class="o">=</span><span class="n">assets</span><span class="p">,</span>
        <span class="n">metrics</span><span class="o">=</span><span class="s2">&quot;ReferenceRateUSD&quot;</span><span class="p">,</span>
        <span class="n">frequency</span><span class="o">=</span><span class="s2">&quot;1m&quot;</span><span class="p">,</span>
        <span class="n">start_time</span><span class="o">=</span><span class="s2">&quot;2024-01-01&quot;</span><span class="p">,</span>
        <span class="n">end_time</span><span class="o">=</span><span class="s2">&quot;2025-01-01&quot;</span><span class="p">,</span>
        <span class="n">page_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">end_inclusive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">parallel</span><span class="p">(</span>
        <span class="n">time_increment</span><span class="o">=</span><span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">export_to_csv</span><span class="p">(</span><span class="s2">&quot;btcRRs.csv&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time taken parallel: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">client</span><span class="o">.</span><span class="n">get_asset_metrics</span><span class="p">(</span>
        <span class="n">assets</span><span class="o">=</span><span class="n">assets</span><span class="p">,</span>
        <span class="n">metrics</span><span class="o">=</span><span class="s2">&quot;ReferenceRateUSD&quot;</span><span class="p">,</span>
        <span class="n">frequency</span><span class="o">=</span><span class="s2">&quot;1m&quot;</span><span class="p">,</span>
        <span class="n">start_time</span><span class="o">=</span><span class="s2">&quot;2022-03-01&quot;</span><span class="p">,</span>
        <span class="n">end_time</span><span class="o">=</span><span class="s2">&quot;2023-03-01&quot;</span><span class="p">,</span>
        <span class="n">page_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">end_inclusive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">export_to_csv</span><span class="p">(</span><span class="s2">&quot;btcRRsNormal.csv&quot;</span><span class="p">)</span>
</code></pre></div>
Notice we pass in the <code>time_increment=relativedelta(months=1)</code> so that means we will split the threads up by month, in
addition to by asset. So this will run a total 36 separate threads, 12 threads for each month x 3 threads for each asset.
The difference it takes in time is dramatic:
<div class="highlight"><pre><span></span><code>Exporting to dataframe type: 100%|██████████| 36/36 [00:00&lt;00:00, 54.62it/s]
Time taken parallel: 0:00:36.654147
Time taken normal: 0:05:20.073826
</code></pre></div></p>
<p>Please note that for short time periods you can pass in a <code>time_increment</code> with <code>datetime.timedelta</code> to specify up to 
several weeks, for larger time frames you can use <code>dateutil.relativedelta.relativedelta</code> in order to split requests
up by increments of months or years.</p>
<h2 id="general-parallelization-guidelines">General Parallelization Guidelines<a class="headerlink" href="#general-parallelization-guidelines" title="Permanent link">&para;</a></h2>
<ul>
<li>If you are using a small <code>page_size</code> and trying to export a large number amount of, this will be your biggest bottleneck.
Generally the fastest <code>page_size</code> is <code>1000</code> to <code>10000</code></li>
<li>If you are unsure why an action is taking a long time, running the CoinMetricsClient using <code>verbose=True</code> or <code>debug=True</code>
can give better insight into what is happening under the hood</li>
<li>The parallel feature is best used when you are exporting a large amount of data, that can be split by query params into 
many smaller requests. A good example of this is market candles over a long time frame - if you are querying hundreds
of markets and are sure there will be data, using <code>.parallel().export_to_csv_files("...")</code> can have a huge performance 
increase, if you are just querying a single market you will not see a difference</li>
<li>The parallel feature is highly configurable, there is several configuration options that may be suitable for advanced
users like tweaking the <code>max_workers</code> parameter, or changing the default <code>ProcessPoolExecutor</code> to a <code>ThreadPoolExectuor</code></li>
<li>Using multithreaded code is inherently more complex, it will be harder to debug issues with long running queries 
when running parallel exports compared to normal single threaded code</li>
<li>For that reason, this tool is best suited for exporting historical data rather than supporting a real time production
system.</li>
<li>The methods that create separate files for each thread will be the safest and most performant to use - <code>.export_to_csv_files()</code>
and <code>.export_to_json_files()</code>. Using the methods that return a single output - <code>.export_to_csv()</code>, <code>export_to_list()</code>, and
<code>.export_to_dataframe()</code> need to join the data from many threads before it can be returned, this may use a lot of memory
if you are accessing data types like market orderbooks or market trades and could fail altogether</li>
<li>If using <code>export_to_csv/json_files()</code> functions, note that by default they will be saved in the directory format <code>/{endpoint}/{parallelize_on}</code>.
For example, in <code>export_to_json_files()</code>, 
<code>client.get_market_trades("coinbase-eth-btc-spot,coinbase-eth-usdc-spot").parallel("markets")</code> will create a file each like ./market-trades/coinbase-eth-btc-spot.json, ./market-trades/coinbase-eth-usdc-spot.json
<code>client.get_asset_metrics('btc,eth', 'ReferenceRateUSD', start_time='2024-01-01', limit_per_asset=1).parallel("assets,metrics", time_increment=timedelta(days=1))</code>
will create a file each like ./asset-metrics/btc/ReferenceRateUSD/start_time=2024-01-01T00-00-00Z.json, ./asset-metrics/eth/ReferenceRateUSD/start_time=2024-01-01T00-00-00Z.json</li>
<li>If you get the error <code>BrokenProcessPool</code> it <a href="https://stackoverflow.com/questions/15900366/all-example-concurrent-futures-code-is-failing-with-brokenprocesspool">might be because you're missing a main() function</a></li>
</ul>
<h2 id="lazy-execution">Lazy Execution<a class="headerlink" href="#lazy-execution" title="Permanent link">&para;</a></h2>
<p><a href="https://docs.pola.rs/user-guide/concepts/lazy-api/">Lazy execution</a> allows you to collect data without executing code right away, giving you flexibility on how to parse your data before performing large computation. This is especially useful if, say, you want to filter for a field which is not a parameter of the API.</p>
<p>For more information on how to use a Lazy API, see the <a href="https://docs.pola.rs/user-guide/lazy/using/">polars guide</a>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">coinmetrics.api_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">CoinMetricsClient</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">CoinMetricsClient</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;CM_API_KEY&quot;</span><span class="p">))</span>

<span class="c1"># Example 1: Prices where Tether is above 1</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">eager_exec_pandas</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_asset_metrics</span><span class="p">(</span><span class="n">assets</span><span class="o">=</span><span class="s2">&quot;usdt&quot;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="s2">&quot;ReferenceRateUSD&quot;</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="s2">&quot;2025-01-01&quot;</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">eager_exec_pandas</span> <span class="o">=</span> <span class="n">eager_exec_pandas</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eager_exec_pandas</span><span class="o">.</span><span class="n">ReferenceRateUSD</span> <span class="o">&gt;=</span> <span class="mf">1.00</span><span class="p">]</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pandas: </span><span class="si">{</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">eager_exec_polars</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_asset_metrics</span><span class="p">(</span><span class="n">assets</span><span class="o">=</span><span class="s2">&quot;usdt&quot;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="s2">&quot;ReferenceRateUSD&quot;</span><span class="p">,</span>  <span class="n">end_time</span><span class="o">=</span><span class="s2">&quot;2025-01-01&quot;</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">dataframe_type</span><span class="o">=</span><span class="s2">&quot;polars&quot;</span><span class="p">)</span>
<span class="n">eager_exec_polars</span> <span class="o">=</span> <span class="n">eager_exec_polars</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ReferenceRateUSD&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">1.00</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Polars (Eager): </span><span class="si">{</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">lazy_exec</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_asset_metrics</span><span class="p">(</span><span class="n">assets</span><span class="o">=</span><span class="s2">&quot;usdt&quot;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="s2">&quot;ReferenceRateUSD&quot;</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="s2">&quot;2025-01-01&quot;</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_lazyframe</span><span class="p">()</span>
<span class="n">lazy_exec</span> <span class="o">=</span> <span class="n">lazy_exec</span><span class="o">.</span><span class="n">cast</span><span class="p">({</span><span class="s2">&quot;change&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Float32</span><span class="p">})</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;ReferenceRateUSD&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">1.00</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Polars (Lazy): </span><span class="si">{</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

<span class="c1"># Example 2: Fees where change &gt;= 0.001 BTC</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">eager_exec_pandas</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_list_of_balance_updates_v2</span><span class="p">(</span><span class="n">asset</span><span class="o">=</span><span class="s2">&quot;btc&quot;</span><span class="p">,</span> <span class="n">accounts</span><span class="o">=</span><span class="s2">&quot;FEES&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">eager_exec_pandas</span> <span class="o">=</span> <span class="n">eager_exec_pandas</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eager_exec_pandas</span><span class="o">.</span><span class="n">change</span> <span class="o">&gt;=</span> <span class="mf">1.0E-3</span><span class="p">]</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pandas: </span><span class="si">{</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">eager_exec_polars</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_list_of_balance_updates_v2</span><span class="p">(</span><span class="n">asset</span><span class="o">=</span><span class="s2">&quot;btc&quot;</span><span class="p">,</span> <span class="n">accounts</span><span class="o">=</span><span class="s2">&quot;FEES&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">dataframe_type</span><span class="o">=</span><span class="s2">&quot;polars&quot;</span><span class="p">)</span>
<span class="n">eager_exec_polars</span> <span class="o">=</span> <span class="n">eager_exec_polars</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">1.0E-3</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Polars (Eager): </span><span class="si">{</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">lazy_exec</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_list_of_balance_updates_v2</span><span class="p">(</span><span class="n">asset</span><span class="o">=</span><span class="s2">&quot;btc&quot;</span><span class="p">,</span> <span class="n">accounts</span><span class="o">=</span><span class="s2">&quot;FEES&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">to_lazyframe</span><span class="p">()</span>
<span class="n">lazy_exec</span> <span class="o">=</span> <span class="n">lazy_exec</span><span class="o">.</span><span class="n">cast</span><span class="p">({</span><span class="s2">&quot;change&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Float32</span><span class="p">})</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">1.0E-3</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Polars (Lazy): </span><span class="si">{</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="introduction.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Introduction">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Introduction
              </div>
            </div>
          </a>
        
        
          
          <a href="examples.html" class="md-footer__link md-footer__link--next" aria-label="Next: Examples">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Examples
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.path", "navigation.indexes", "navigation.footer", "toc.follow", "toc.integrate", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>