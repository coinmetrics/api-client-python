<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>Flat Files Exporter - Coin Metrics Python API Client</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Flat Files Exporter";
        var mkdocs_page_input_path = "FlatFilesExport.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="index.html">
          <img src="assets/images/logo.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="index.html">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="api_client.html">API Client Spec</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Flat Files Exporter</a>
    <ul class="current">
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Coin Metrics Python API Client</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Flat Files Exporter</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="exporting-flat-files">Exporting flat files<a class="headerlink" href="#exporting-flat-files" title="Permanent link">&para;</a></h2>
<p>Along with the API client we provide a data exporting tool which allow downloading large amount of data as flat files
rather than from the API itself. The tool allows users to download daily files over our entire provided history for 
market trades, market quotes, and market candles.  </p>
<h2 id="authorization-for-flat-files-download">Authorization for flat files download<a class="headerlink" href="#authorization-for-flat-files-download" title="Permanent link">&para;</a></h2>
<p>This program was set up to easily access a flat files server provided to Coin Metrics commercial clients. If you are a 
community API user or a client without access to this server, a 403 error will be returned. If you are a community API 
user and looking to get historical asset prices, Coin Metrics does offer <a href="https://coinmetrics.io/community-network-data/">historical asset prices for download</a>.<br />
The <code>CoinMetricsDataExporter</code> class will return a <code>CoinMetricsUnauthorizedException</code> if your API key is not authorized
to access this server. The flat files export is considered a separate product from the Coin Metrics API, if you would
like to gain access or believe you should have access but do not, please contact coinmetrics support. </p>
<h3 id="installation-and-set-up">Installation and set up<a class="headerlink" href="#installation-and-set-up" title="Permanent link">&para;</a></h3>
<p>The tool is installed a long with the <code>coinmetrics-api-client</code>, it's recommended to create a new Python [virtual environment] 
for your project and install the package:  </p>
<div class="highlight"><pre><span></span><code>python -m venv .venv 
source .venv/bin/activate 
pip install coinmetrics-api-client
</code></pre></div>
<p>The export tool requires access to a CoinMetrics API key, and is accessed with the environment variable <code>CM_API_KEY</code>,
the easiest way to set this is to run <code>export CM_API_KEY=&lt;API_KEY&gt;</code> in your terminal on MacOS/Linux or just <code>set CM_API_KEY=&lt;API_KEY&gt;</code> 
on Windows. Additionally, you have the option of passing it in which each command instead.</p>
<p>To confirm the tool is installed correct execute the command <code>coinmetrics export --help</code> which brings up relevant 
documentation. At the bottom of the help message all the available commands are shown:<br />
<div class="highlight"><pre><span></span><code>Commands:
  get-asset-pairs
  get-exchanges
  market-candles-future  Used to export data related to future market...
  market-candles-spot    Used to export data related to spot market candles.
  market-quotes-future   Used to export data related to future market...
  market-quotes-spot     Used to export data related to spot market quotes...
  market-trades-future   Used to export data related to future market...
  market-trades-spot     Used to export data related to spot market trades.
</code></pre></div></p>
<h3 id="exporting-market-trades-files">Exporting Market Trades Files<a class="headerlink" href="#exporting-market-trades-files" title="Permanent link">&para;</a></h3>
<p>Further documentation is available on any of the commands by running <code>coinmetrics export &lt;command&gt; --help</code>, for example
running <code>coinmetrics export market-trades-spot --help</code> prints: 
<div class="highlight"><pre><span></span><code>Usage: coinmetrics export market-trades-spot [OPTIONS] EXCHANGES [START_DATE]:
                                             [%Y-%m-%d|%Y-%m-%dT%H:%M:%S|%Y-%m
                                             -%d %H:%M:%S] [END_DATE]:[%Y-%m-%
                                             d|%Y-%m-%dT%H:%M:%S|%Y-%m-%d
                                             %H:%M:%S]

  Used to export data related to spot market trades. Format: coinmetrics
  export market-trades-spot &lt;exchanges&gt; &lt;start_date&gt; &lt;end_date&gt; Example:
  coinmetrics export market-trades-spot coinbase,binance 2022-01-01
  2022-01-03.

Arguments:
  EXCHANGES                       Pass in arguments as a list of strings
                                  separated by by commas i.e.
                                  binance,coinbase,bitmex  [required]

  [START_DATE]:[%Y-%m-%d|%Y-%m-%dT%H:%M:%S|%Y-%m-%d %H:%M:%S]
                                  [default: 2022-08-10]
  [END_DATE]:[%Y-%m-%d|%Y-%m-%dT%H:%M:%S|%Y-%m-%d %H:%M:%S]
                                  [default: 2022-08-10]

Options:
  --output-format TEXT        [default: json.gz]
  --threaded / --no-threaded  [default: False]
  --api-key TEXT
  --help                      Show this message and exit.
</code></pre></div></p>
<h4 id="example">Example:<a class="headerlink" href="#example" title="Permanent link">&para;</a></h4>
<p>If you want to get the flat files for spot-market-trades from coinbase and binance for the first 5 days of June 2022:
<code>coinmetrics export market-trades-spot binance,coinbase 2022-06-01 2022-06-05</code>  </p>
<p>In your current directory you will see:<br />
<div class="highlight"><pre><span></span><code>market-trades-spot
├── binance
│   ├── 2022-06-01.json.gz
│   ├── 2022-06-02.json.gz
│   ├── 2022-06-03.json.gz
│   ├── 2022-06-04.json.gz
│   └── 2022-06-05.json.gz
└── coinbase
    ├── 2022-06-01.json.gz
    ├── 2022-06-02.json.gz
    ├── 2022-06-03.json.gz
    ├── 2022-06-04.json.gz
    └── 2022-06-05.json.gz
</code></pre></div>
By default the files are downloaded as <a href="https://fileinfo.com/extension/gz">gzipped json files</a> - they are compressed in 
order to take up less space. If you instead wish to download the data as a csv or json you can use:<br />
<code>coinmetrics export market-trades-spot binance,coinbase 2022-06-01 2022-06-05 --output-format csv</code></p>
<p>The functionality for getting future, rather than spot market trades is the exact same, just replace <code>market-trades-spot</code>
with <code>market-trades-future</code></p>
<p>In order to figure out what exchanges are supported for a flat file type you can run <code>coinmetrics export get-exchanges &lt;command&gt;</code>, 
so in this case running <code>coinmetrics export get-exchanges market-trades-spot</code></p>
<h3 id="exporting-market-quotes">Exporting market quotes<a class="headerlink" href="#exporting-market-quotes" title="Permanent link">&para;</a></h3>
<p>Market quotes are similar to market trades, except data is separated by exchange and by asset-pair. So you must provide
both what exchanges you are querying as well the specific asset pairs.</p>
<p>Example if you wanted to export files to market quotes for ETHUSDT and BTCUSDT over a certain timeframe as json files:<br />
<code>coinmetrics export market-quotes-spot binance ETHUSDT,BTCUSDT 2022-03-03 2022-03-05 --output-format json</code>  </p>
<p>In order to find what asset pairs are availible you can query this information with <code>coinmetrics export get-asset-pairs &lt;command&gt; &lt;exchange&gt;</code>
so in this case, for Binance you would run <code>coinmetrics export get-asset-pairs market-quotes-spot binance</code>. If you are comfortable 
with command line tools it may be helpful to string this with unix command line tools like <code>grep</code>. For example, to find all the BTC related pairs 
for binance you might run <code>coinmetrics export get-asset-pairs market-quotes-spot binance | grep BTC</code>.</p>
<p>The functionality is the same for <code>market-qutoes-futures</code>.</p>
<h3 id="exporting-market-candles">Exporting market candles<a class="headerlink" href="#exporting-market-candles" title="Permanent link">&para;</a></h3>
<p>Exporting market candles also functions similar to market trades, however you must specify a frequency in addition to
an exchange and date range. The frequency denominates the range which the market candles cover. These frequencies are 
currently <code>"1m", "5m", "10m", "15m", "30m", "1h", and "1d"</code>. </p>
<p>Example to download 5m spot market candles for coinbase and binance for a date range:<br />
<code>coinmetrics export market-candles-spot 5m coinbase,binance 2022-01-01 2022-01-05</code><br />
Which creates these files:<br />
<div class="highlight"><pre><span></span><code>market-candles-spot-5m
├── binance
│   ├── 2022-01-01.json.gz
│   ├── 2022-01-02.json.gz
│   ├── 2022-01-03.json.gz
│   ├── 2022-01-04.json.gz
│   └── 2022-01-05.json.gz
└── coinbase
    ├── 2022-01-01.json.gz
    ├── 2022-01-02.json.gz
    ├── 2022-01-03.json.gz
    ├── 2022-01-04.json.gz
    └── 2022-01-05.json.gz
</code></pre></div></p>
<p>The functionality is the same for <code>market-candles-future</code></p>
<h3 id="using-api-key-without-setting-an-environment-variable">Using API Key without setting an environment variable<a class="headerlink" href="#using-api-key-without-setting-an-environment-variable" title="Permanent link">&para;</a></h3>
<p>If you don't wish to put your CoinMetrics API key in your environment, you may also pass it in with any command with the
flag <code>--api-key</code>. Example:<br />
<code>coinmetrics export market-candles-spot 5m coinbase,binance 2022-01-01 2022-01-05 --api-key &lt;API_KEY&gt;</code></p>
<h3 id="downloading-files-in-parallel">Downloading files in parallel<a class="headerlink" href="#downloading-files-in-parallel" title="Permanent link">&para;</a></h3>
<p>If you are downloading many files and want to speed the process up there is an option to concurrently download multiple 
rather than one at a time, using the <code>--threaded</code> flag. Example:<br />
<code>coinmetrics export market-candles-spot 5m coinbase,binance 2022-01-01 2022-01-05 --threaded</code><br />
Note that using this option will consume more system resources and network bandwith, and the download speed will still
be limited by egress from the files server as well as the specs of your machine. </p>
<h3 id="using-the-coinmetricsdataexporter-in-python-instead-of-cli">Using the CoinMetricsDataExporter in Python instead of CLI<a class="headerlink" href="#using-the-coinmetricsdataexporter-in-python-instead-of-cli" title="Permanent link">&para;</a></h3>
<p>Depending on the use case it might be more convenient to use the CoinMetricsDataExporter directly in Python rather than
from the CLI. There is several examples <a href="examples/files_download">here</a> as well as one below:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">coinmetrics.data_exporter</span> <span class="kn">import</span> <span class="n">CoinMetricsDataExporter</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">CM_API_KEY</span> <span class="o">=</span> <span class="s2">&quot;&lt;YOUR_API_KEY&gt;&quot;</span>
<span class="n">data_exporter</span> <span class="o">=</span> <span class="n">CoinMetricsDataExporter</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">CM_API_KEY</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This script will export all the daily market-trades-spot files for Coinbase and Gemini for the month of January  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
    <span class="n">exchanges</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;coinbase&quot;</span><span class="p">,</span><span class="s2">&quot;gemini&quot;</span><span class="p">]</span>
    <span class="n">data_exporter</span><span class="o">.</span><span class="n">export_market_trades_spot_data</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">exchanges</span><span class="o">=</span><span class="n">exchanges</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="api_client.html" class="btn btn-neutral float-left" title="API Client Spec"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="api_client.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>var base_url = ".";</script>
    <script src="js/theme_extra.js"></script>
    <script src="js/theme.js"></script>
      <script src="search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
